generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL_MYSQL")
}

model accion_comercial {
  accion_comercial_id   Int                     @id @default(autoincrement())
  cliente_id            Int?
  cita_id               Int?
  pago_id               Int?
  persona_id            Int?
  estado                String?                 @db.VarChar(25)
  fecha_accion          DateTime?               @default(now()) @db.Timestamp(6)
  nota                  String
  gestor                String?                 @db.VarChar(255)
  cliente               cliente?                @relation(fields: [cliente_id], references: [cliente_id], onDelete: Cascade, onUpdate: NoAction, map: "accion_comercial_ibfk_1")
  cita                  cita?                   @relation(fields: [cita_id], references: [cita_id], onUpdate: NoAction, map: "accion_comercial_ibfk_2")
  pago                  pago?                   @relation(fields: [pago_id], references: [pago_id], onUpdate: NoAction, map: "accion_comercial_ibfk_3")
  persona               persona?                @relation(fields: [persona_id], references: [persona_id], onUpdate: NoAction, map: "accion_comercial_ibfk_4")
  historico_observacion historico_observacion[]
}

model campanha {
  campanha_id       Int                @id @default(autoincrement())
  nombre_campanha   String             @db.VarChar(100)
  descripcion       String?
  fecha_creacion    DateTime?          @default(now()) @db.Timestamp(6)
  estado_campanha   String?            @default("activa") @db.VarChar(25)
  mensaje_cliente   String?
  fecha_inicio      DateTime?          @default(now()) @db.Timestamp(6)
  fecha_fin         DateTime?          @db.Timestamp(6)
  num_clientes      Int?               @default(0)
  tipo              String             @default("in") @db.VarChar(10)
  template_id       Int?
  variable_mappings Json?
  template          template?          @relation(fields: [template_id], references: [id], map: "fk_campanha_template")
  cliente_campanha  cliente_campanha[]
}

model cita {
  cita_id          Int                @id @default(autoincrement())
  cliente_id       Int
  conversacion_id  Int?
  fecha_cita       DateTime           @db.Timestamp(6)
  estado_cita      String?            @default("agendada") @db.VarChar(25)
  motivo           String             @db.VarChar(100)
  fecha_creacion   DateTime           @default(now()) @db.Timestamp(6)
  aviso            Boolean?           @default(false)
  accion_comercial accion_comercial[]
  cliente          cliente            @relation(fields: [cliente_id], references: [cliente_id], onDelete: Cascade, onUpdate: NoAction, map: "cita_ibfk_1")
  conversacion     conversacion?      @relation(fields: [conversacion_id], references: [conversacion_id], onUpdate: NoAction, map: "cita_ibfk_2")
  pago             pago[]
}

model cliente {
  cliente_id                   Int                     @id @default(autoincrement())
  documento_identidad          String?                 @db.VarChar(12)
  tipo_documento               String?                 @db.VarChar(20)
  nombre                       String                  @db.VarChar(100)
  apellido                     String?                 @db.VarChar(100)
  celular                      String                  @db.VarChar(20)
  email                        String?                 @db.VarChar(100)
  fecha_creacion               DateTime?               @default(now()) @db.Timestamp(6)
  fecha_ultima_interaccion     DateTime?               @db.Timestamp(6)
  fecha_ultima_interaccion_bot DateTime?               @db.Timestamp(6)
  estado                       String?                 @default("en seguimiento")
  motivo                       String?                 @default("desconocido")
  categoria_no_interes         String?                 @db.VarChar(20)
  detalle_no_interes           String?                 @db.VarChar(100)
  bound                        Boolean?
  observacion                  String?
  gestor                       String?                 @default("") @db.VarChar(100)
  accion                       String?                 @default("") @db.VarChar(50)
  in_out                       Boolean?                @default(false)
  score                        String                  @default("no_score") @db.VarChar(20)
  fecha_ultimo_estado          DateTime?               @db.Timestamp(6)
  Segmento                     String?
  Codigo_Asociado              String?
  Zona                         String?
  Cluster                      String?
  Producto                     String?
  accion_comercial             accion_comercial[]
  cita                         cita[]
  cliente_campanha             cliente_campanha[]
  codigo_pago                  codigo_pago[]
  conversacion                 conversacion[]
  historico_estado             historico_estado[]
  historico_observacion        historico_observacion[]
  leadh                        leadh[]
  pago                         pago[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model cliente_campanha {
  cliente_campanha_id Int       @id @default(autoincrement())
  cliente_id          Int
  campanha_id         Int
  fecha_asociacion    DateTime? @default(now()) @db.Timestamp(6)
  whatsapp_message_id String?   @db.VarChar(255)
  message_status      String?   @db.VarChar(20)
  error_code          Int?
  last_update         DateTime? @default(now()) @db.Timestamp(6)
  estado_mensaje      String?   @db.VarChar(25)
  fecha_envio         DateTime? @db.Timestamp(6)
  fecha_ultimo_estado DateTime? @db.Timestamp(6)
  error_descripcion   String?
  cliente             cliente   @relation(fields: [cliente_id], references: [cliente_id], onDelete: Cascade, onUpdate: NoAction, map: "cliente_campanha_ibfk_1")
  campanha            campanha  @relation(fields: [campanha_id], references: [campanha_id], onDelete: Cascade, onUpdate: NoAction, map: "cliente_campanha_ibfk_2")

  @@index([whatsapp_message_id], map: "idx_message_id")
}

model codigo_pago {
  id_codigo_pago    Int       @id @default(autoincrement())
  cliente_id        Int?
  codigo            Int       @unique
  tipo_codigo       String?   @db.VarChar(50)
  caso_relacionado  String?   @db.VarChar(100)
  fecha_asignacion  DateTime  @db.Date
  fecha_vencimiento DateTime? @db.Date
  activo            Boolean?  @default(true)
  pago_realizado    Boolean?  @default(false)
  cliente           cliente?  @relation(fields: [cliente_id], references: [cliente_id], onDelete: Cascade, onUpdate: NoAction, map: "codigo_pago_fk_cliente")
}

model conversacion {
  conversacion_id          Int       @id @default(autoincrement())
  cliente_id               Int
  fecha_conversacion       DateTime? @default(now()) @db.Timestamp(6)
  tipo_conversacion        String?   @db.VarChar(50)
  mensaje                  String?
  resultado                String?   @db.VarChar(50)
  estado_conversacion      String?   @default("activa") @db.VarChar(25)
  fecha_ultima_interaccion DateTime? @default(now()) @db.Timestamp(6)
  nivel_satisfaccion       String?   @db.VarChar(25)
  cita                     cita[]
  cliente                  cliente   @relation(fields: [cliente_id], references: [cliente_id], onDelete: Cascade, onUpdate: NoAction, map: "conversacion_ibfk_1")
}

model historico_estado {
  historico_estado_id Int       @id @default(autoincrement())
  cliente_id          Int
  estado              String
  fecha_estado        DateTime? @default(now()) @db.Timestamp(6)
  detalle             String?
  cliente             cliente   @relation(fields: [cliente_id], references: [cliente_id], onDelete: Cascade, onUpdate: NoAction, map: "historico_estado_ibfk_1")
}

model leadh {
  leadh_id       Int      @id @default(autoincrement())
  cliente_id     Int
  fecha_contacto DateTime @db.Timestamp(6)
  prioridad_lead Int
  leadh_source   String   @db.VarChar(100)
  campanha       String?  @db.VarChar(100)
  tipo           String?  @db.VarChar(100)
  canal_lead     String?  @db.VarChar(20)
  estado_lead    String?  @default("en seguimiento") @db.VarChar(25)
  nota           String?
  cliente        cliente  @relation(fields: [cliente_id], references: [cliente_id], onDelete: Cascade, onUpdate: NoAction, map: "leadh_ibfk_1")
}

model notificaciones {
  id_notificacion Int       @id @default(autoincrement())
  cliente_id      Int?
  mensaje         String?
  fecha           DateTime? @default(now()) @db.Timestamp(6)
}

model pago {
  pago_id          Int                @id @default(autoincrement())
  cliente_id       Int
  cita_id          Int?
  fecha_pago       DateTime           @db.Timestamp(6)
  monto            Decimal?           @db.Decimal(10, 2)
  metodo_pago      String             @db.VarChar(50)
  estado_pago      String?            @default("pendiente") @db.VarChar(25)
  first_name       String?            @default("") @db.VarChar(40)
  last_name        String?            @default("") @db.VarChar(40)
  num_operacion    String?            @default("") @db.VarChar(40)
  accion_comercial accion_comercial[]
  cliente          cliente            @relation(fields: [cliente_id], references: [cliente_id], onDelete: Cascade, onUpdate: NoAction, map: "pago_ibfk_1")
  cita             cita?              @relation(fields: [cita_id], references: [cita_id], onUpdate: NoAction, map: "pago_ibfk_2")
}

model persona {
  persona_id       Int                @id
  nombre           String             @db.VarChar(120)
  primer_apellido  String             @db.VarChar(120)
  segundo_apellido String?            @db.VarChar(120)
  celular          String?            @db.VarChar(12)
  num_leads        Int?               @default(0)
  accion_comercial accion_comercial[]
  usuario          usuario            @relation(fields: [persona_id], references: [usuario_id], onDelete: Cascade, onUpdate: NoAction, map: "persona_fk_usuario")
}

model rol {
  rol_id      Int       @id @default(autoincrement())
  nombre_rol  String    @unique @db.VarChar(50)
  descripcion String?   @db.VarChar(255)
  usuario     usuario[]
}

model template {
  id                   Int        @id @default(autoincrement())
  nombre_template      String     @db.VarChar(100)
  mensaje              String
  created_at           DateTime   @default(now()) @db.Timestamp(6)
  template_content_sid String     @default("") @db.VarChar(120)
  parametro            Boolean    @default(false)
  campanha             campanha[]
}

model usuario {
  usuario_id Int      @id @default(autoincrement())
  username   String   @unique @db.VarChar(50)
  password   String   @db.VarChar(255)
  rol_id     Int?     @default(2)
  activo     Boolean  @default(true)
  persona    persona?
  rol        rol?     @relation(fields: [rol_id], references: [rol_id], onUpdate: NoAction, map: "usuario_fk_rol")
}

model mensaje_out {
  id_msg               String                 @id
  phone_to             String
  template_name        String
  template_lang        String
  campanha_id          String?
  sent_at              DateTime               @default(now()) @db.Timestamp(6)
  mensaje_status_event mensaje_status_event[]

  @@index([campanha_id], map: "idx_mensaje_out_campanha")
  @@index([phone_to], map: "idx_mensaje_out_phone_to")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model mensaje_status_event {
  id                BigInt      @id @default(autoincrement())
  id_msg            String
  estado            String
  ts_unix           BigInt?
  recipient_id      String?
  pricing_json      Json?
  conversation_json Json?
  errors_json       Json?
  created_at        DateTime    @default(now()) @db.Timestamp(6)
  mensaje_out       mensaje_out @relation(fields: [id_msg], references: [id_msg], onDelete: Cascade, onUpdate: NoAction)

  @@index([estado], map: "idx_mse_estado")
  @@index([id_msg, created_at(sort: Desc)], map: "idx_mse_idmsg_created")
}

model historico_observacion {
  historico_observacion_id Int               @id @default(autoincrement())
  cliente_id               Int
  accion_comercial_id      Int?
  observacion              String
  fecha_creacion           DateTime?         @default(now()) @db.Timestamptz(6)
  accion_comercial         accion_comercial? @relation(fields: [accion_comercial_id], references: [accion_comercial_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_historico_accion_comercial")
  cliente                  cliente           @relation(fields: [cliente_id], references: [cliente_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_historico_cliente")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model cliente_backup {
  cliente_id                   Int?
  documento_identidad          String?   @db.VarChar(12)
  tipo_documento               String?   @db.VarChar(20)
  nombre                       String?   @db.VarChar(100)
  apellido                     String?   @db.VarChar(100)
  celular                      String?   @db.VarChar(20)
  email                        String?   @db.VarChar(100)
  fecha_creacion               DateTime? @db.Timestamp(6)
  fecha_ultima_interaccion     DateTime? @db.Timestamp(6)
  fecha_ultima_interaccion_bot DateTime? @db.Timestamp(6)
  estado                       String?
  motivo                       String?
  categoria_no_interes         String?   @db.VarChar(20)
  detalle_no_interes           String?   @db.VarChar(100)
  bound                        Boolean?
  observacion                  String?
  gestor                       String?   @db.VarChar(100)
  accion                       String?   @db.VarChar(50)
  in_out                       Boolean?
  score                        String?   @db.VarChar(20)
  fecha_ultimo_estado          DateTime? @db.Timestamp(6)
  Segmento                     String?
  Codigo_Asociado              String?
  Zona                         String?
  Cluster                      String?
  Producto                     String?

  @@ignore
}
